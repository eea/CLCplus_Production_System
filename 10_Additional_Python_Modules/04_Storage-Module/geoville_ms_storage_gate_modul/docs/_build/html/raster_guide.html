

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How to work with raster data &mdash; GeoVille Storage Gate 21.4 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="How to work with vector data" href="vector_guide.html" />
    <link rel="prev" title="How to work with netCDF files" href="ncdf_guide.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #f7d299" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> GeoVille Storage Gate
          

          
            
            <img src="_static/storage_gate_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                21.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">GETTING STARTED:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">HOW-TO GUIDES:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ncdf_guide.html">How to work with netCDF files</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to work with raster data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#create-a-netcdf-file-or-group">Create a netCDF file or group</a></li>
<li class="toctree-l2"><a class="reference internal" href="#upsert-using-the-group-name">Upsert using the group name</a></li>
<li class="toctree-l2"><a class="reference internal" href="#update-using-bounds">Update using bounds</a></li>
<li class="toctree-l2"><a class="reference internal" href="#read-using-the-group-name">Read using the group name</a></li>
<li class="toctree-l2"><a class="reference internal" href="#read-using-bounds">Read using bounds</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="vector_guide.html">How to work with vector data</a></li>
</ul>
<p class="caption"><span class="caption-text">USAGE EXAMPLES:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="usage_example/usage_examples.html">Usage examples</a></li>
</ul>
<p class="caption"><span class="caption-text">REFERENCE GUIDE:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="geoville_storage_gate.html">geoville_storage_gate</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GeoVille Storage Gate</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>How to work with raster data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/raster_guide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="how-to-work-with-raster-data">
<h1>How to work with raster data<a class="headerlink" href="#how-to-work-with-raster-data" title="Permalink to this headline">¶</a></h1>
<p>When writing and reading a raster into a netCDF file, there are several
options. The following instructions shall serve as a guide.</p>
<div class="section" id="create-a-netcdf-file-or-group">
<h2>Create a netCDF file or group<a class="headerlink" href="#create-a-netcdf-file-or-group" title="Permalink to this headline">¶</a></h2>
<p>When writing a raster into a netCDF file or a group that does not exist yet,
only <code class="docutils literal notranslate"><span class="pre">create_by_group</span></code> can be used. This function creates a netCDF file in
case it does not exist. Moreover, the defined group will be created before
the raster gets inserted. Therefore, the group will have the metadata and
dimensions of the raster’s profile.</p>
<p>Many programs that create raster products end by having a numpy array.</p>
<p>If that array gets stored as a GeoTiff, the module <code class="docutils literal notranslate"><span class="pre">rasterio</span></code> can easily
read it as a numpy array again:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rasterio</span>

<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;example.tif&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">profile</span><span class="p">()</span>
</pre></div>
</div>
<p>Now that we have a numpy array and the raster’s metadata (profile), we can
store it into a netCDF file for the first time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">create_by_group</span><span class="p">(</span><span class="n">array</span><span class="p">,</span>
                <span class="n">profile</span><span class="p">,</span>
                <span class="n">ncdf_path</span><span class="o">=</span><span class="s2">&quot;example.nc&quot;</span><span class="p">,</span>
                <span class="n">group</span><span class="o">=</span><span class="s2">&quot;example_group_name&quot;</span><span class="p">,</span>
                <span class="n">start_time</span><span class="o">=</span><span class="s2">&quot;2019-05-01&quot;</span><span class="p">,</span>
                <span class="n">end_time</span><span class="o">=</span><span class="s2">&quot;2019-05-10&quot;</span><span class="p">,</span>
                <span class="n">array_variable</span><span class="o">=</span><span class="s2">&quot;raster&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we created the example netCDF file “example.nc” with the group
“example_group_name”. This group does contain the array as a variable with
the name “raster”. Furthermore, we defined the start and the end date,
that describe the layers of the given array. In our example we defined a range
of 10 days (2019-05-01 - 2019-05-10). Hence, the array we write also needs to
have 10 layers (axis 0 = 10).</p>
<p>The dictionary “profile” serves to save the geospatial metadata as group
attributes. It contains the geotransformation, the coordinate reference system,
etc. Note that the profile needs to contain “nodata”, “transform”,
“dtype” and “crs” in order to reuse it later again (see <a class="reference external" href="https://rasterio.readthedocs.io/en/latest/topics/profiles.html">rasterio-profile</a>).</p>
</div>
<div class="section" id="upsert-using-the-group-name">
<h2>Upsert using the group name<a class="headerlink" href="#upsert-using-the-group-name" title="Permalink to this headline">¶</a></h2>
<p>After creating a netCDF file and a group, the entire group can be upserted.
An “upsert” means that if the timestamp already exists, the raster will get
replaced, otherwise it gets inserted.
In case of the following example, the raster that gets written represents the
two dates: “2019-04-30”, “2019-05-01”. Again, the array needs to have
the same z-axis than the given time range which is two days in this example.
The first date does not exist yet and thus gets added while the second date
already exists, so it gets updated.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">upsert_by_group</span><span class="p">(</span><span class="n">array</span><span class="p">,</span>
                <span class="n">profile</span><span class="p">,</span>
                <span class="n">ncdf_output_path</span><span class="p">,</span>
                <span class="s2">&quot;test_raster_group&quot;</span><span class="p">,</span>
                <span class="s2">&quot;2019-04-30&quot;</span><span class="p">,</span>
                <span class="s2">&quot;2019-05-01&quot;</span><span class="p">,</span>
                <span class="n">array_variable</span><span class="o">=</span><span class="s2">&quot;raster&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="update-using-bounds">
<h2>Update using bounds<a class="headerlink" href="#update-using-bounds" title="Permalink to this headline">¶</a></h2>
<p>If you want to update an area that might intersect several groups,
you need to use <code class="docutils literal notranslate"><span class="pre">update_by_bounds</span></code> as follows. Note that this function is an
update only and no upsert.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">example_bounds</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([[</span><span class="mf">661697.166128716</span><span class="p">,</span> <span class="mf">4320223.863762978</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">660697.2823883237</span><span class="p">,</span> <span class="mf">4320130.124662316</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">660603.5432876621</span><span class="p">,</span> <span class="mf">4321296.655692774</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">661738.8279512323</span><span class="p">,</span> <span class="mf">4321234.162958999</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">661697.166128716</span><span class="p">,</span> <span class="mf">4320223.863762978</span><span class="p">]])</span>

<span class="n">update_by_bounds</span><span class="p">(</span><span class="n">array_for_update</span><span class="p">,</span>
               <span class="n">profile</span><span class="p">,</span>
               <span class="n">ncdf_path</span><span class="o">=</span><span class="s2">&quot;example.nc&quot;</span><span class="p">,</span>
               <span class="n">bounds</span><span class="o">=</span><span class="n">example_bounds</span><span class="p">,</span>
               <span class="n">start_time</span><span class="o">=</span><span class="s2">&quot;2019-05-04&quot;</span><span class="p">,</span>
               <span class="n">end_time</span><span class="o">=</span><span class="s2">&quot;2019-05-04&quot;</span><span class="p">,</span>
               <span class="n">array_variable</span><span class="o">=</span><span class="s2">&quot;raster&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>For an update, we use the same “ncdf_path” as before. The “array_for_update”
can be bigger than the bounds, but only the data within the bounds will be used
for an update. Again, the array needs to have the same z-axis than the given
time range which is one day in this example. So we update only one day
(2019-05-04) within the “example_bounds”. Note that the coordinate reference
system (crs) of the bounds you use, has to be the same than the crs of the
netCDF dataset. The same goes for the metadata of the “profile”. You cannot use
another datatype or nodata value when updating an existing raster dataset.
Moreover, the “array_variable” of the update needs to coincide with the
“array_variable” of the raster within the netCDF file that will get updated.
In case the bounds intersect more than one netCDF group, each of those groups
will get updated respectively without changing the dimensions.</p>
</div>
<div class="section" id="read-using-the-group-name">
<h2>Read using the group name<a class="headerlink" href="#read-using-the-group-name" title="Permalink to this headline">¶</a></h2>
<p>Reading the raster of an entire netCDF group is as easy as defining the
path to the netCDF file (“ncdf_path”), the correct “group” name and the
variable name (“array_variable”) of the data you want to obtain. Furthermore,
the start and end date selects only the layers you want to have from the entire
data cube.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">read_by_group</span><span class="p">(</span><span class="n">ncdf_path</span><span class="o">=</span><span class="s2">&quot;example.nc&quot;</span><span class="p">,</span>
                               <span class="n">start_time</span><span class="o">=</span><span class="s2">&quot;2019-05-02&quot;</span><span class="p">,</span>
                               <span class="n">end_time</span><span class="o">=</span><span class="s2">&quot;2019-05-08&quot;</span><span class="p">,</span>
                               <span class="n">group</span><span class="o">=</span><span class="s2">&quot;example_group_name&quot;</span><span class="p">,</span>
                               <span class="n">array_variable</span><span class="o">=</span><span class="s2">&quot;raster&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In our example, we obtain a numpy array with 7 layers, one for each day.
Additionally we get the profile returned so that we can write the numpy array
into any other format we want, such as a GeoTiff:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rasterio</span>

<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;example_subset.tif&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">profile</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">lid</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
        <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">lid</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The profile also contains a list of date strings referring to the layers of the
array. For example, if the start date is 2019-05-02 and the end date is
2019-05-08, but we only get 4 layers instead of 7, we can assume, that the
netCDF file does not have all the dates. If we want to know which layer
corresponds to which of the possible 7 dates, we can check the profile.</p>
</div>
<div class="section" id="read-using-bounds">
<h2>Read using bounds<a class="headerlink" href="#read-using-bounds" title="Permalink to this headline">¶</a></h2>
<p>If we do not care about the group names or want to have a subset of data that
can even intersect more than one group, the function <code class="docutils literal notranslate"><span class="pre">read_by_bounds</span></code> can
be used.</p>
<p>It is basically the same than <code class="docutils literal notranslate"><span class="pre">read_by_group</span></code> but instead of a group name,
a shapely Polygon representing a boundary of interest is required.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">example_bounds</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([[</span><span class="mf">661697.166128716</span><span class="p">,</span> <span class="mf">4320223.863762978</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">660697.2823883237</span><span class="p">,</span> <span class="mf">4320130.124662316</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">660603.5432876621</span><span class="p">,</span> <span class="mf">4321296.655692774</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">661738.8279512323</span><span class="p">,</span> <span class="mf">4321234.162958999</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">661697.166128716</span><span class="p">,</span> <span class="mf">4320223.863762978</span><span class="p">]])</span>

<span class="n">array</span><span class="p">,</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">read_by_bounds</span><span class="p">(</span><span class="n">ncdf_path</span><span class="o">=</span><span class="s2">&quot;example.nc&quot;</span><span class="p">,</span>
                               <span class="n">start_time</span><span class="o">=</span><span class="s2">&quot;2019-05-02&quot;</span><span class="p">,</span>
                               <span class="n">end_time</span><span class="o">=</span><span class="s2">&quot;2019-05-08&quot;</span><span class="p">,</span>
                               <span class="n">bounds</span><span class="o">=</span><span class="n">example_bounds</span><span class="p">,</span>
                               <span class="n">array_variable</span><span class="o">=</span><span class="s2">&quot;raster&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="vector_guide.html" class="btn btn-neutral float-right" title="How to work with vector data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ncdf_guide.html" class="btn btn-neutral float-left" title="How to work with netCDF files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, GeoVille GmbH

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>